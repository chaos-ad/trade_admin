
<!DOCTYPE HTML>
<html>
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>
        <script type="text/javascript">

            function make_bar(item) {
                return [item.time * 1000, item.open, item.high, item.low, item.close];
            };

            function make_price(item) {
                return [item.time * 1000, item.close];
            };

            function make_bid(item) {
                return { x: item.time * 1000, title: item.type };
            };

            function parse_qs() {
                var nvpair = {};
                var qs = window.location.search.replace('?', '');
                var pairs = qs.split('&');
                $.each(pairs, function(i, v){
                    var pair = v.split('=');
                    nvpair[pair[0]] = pair[1];
                });
                return nvpair;
            };

            $(function() {
                var query = parse_qs();
                var url = "/api/tester?" + jQuery.param(query);
                $.getJSON(url, function(data) {
                    var bids = data.bids.map(make_bid);
                    var history = data.history.map(make_bar);

                    // create the chart
                    chart = new Highcharts.StockChart({
                        chart : {
                            renderTo : 'container'
                        },
                        series : [{
                            type: 'candlestick',
                            data: history,
                            id: 'history',
                            shadow : true,
                            tooltip : {
                                yDecimals : 2
                            }
                        }, {
                            type: 'flags',
                            data: bids,
                            onSeries: 'history',
                            shape: 'squarepin'
                        }]
                    });
                });
            });

        </script>
    </head>
    <body>
        <div id="container" style="height: 400px; min-width: 600px"></div>
        <script type="text/javascript" src="/js/highstock.src.js"></script>
    </body>
</html>
